<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | MccGameMini</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
</head>
<body>

    <div id="unity-container" class="unity-desktop">
        <span id="launchParamsLog">99999999999</span>
        <button id="btnShare" style="padding: 10px; margin-top: 20px;">Share to Friends</button>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <script type="application/javascript">
        // Khởi tạo Telegram WebApp
        const DemoApp = {
            initDataUnsafe: Telegram.WebApp.initDataUnsafe || {},
            
            init() {
                Telegram.WebApp.ready();

                // Lấy `start_param` từ initDataUnsafe
                const startParam = DemoApp.initDataUnsafe.start_param || '';

                if (startParam) {
                    try {
                        // Giải mã Base64
                        const decodedData = atob(startParam);

                        // Parse chuỗi JSON
                        const parsedData = JSON.parse(decodedData);

                        // Hiển thị kết quả trên màn hình
                        console.log("[Web] Decoded Data:", decodedData);
                        console.log("[Web] Parsed Data:", parsedData);

                        // Hiển thị trên trang web
                        document.getElementById('launchParamsLog').innerHTML = `
                            <pre>Decoded Data: ${decodedData}</pre>
                            <pre>Parsed Data: ${JSON.stringify(parsedData, null, 2)}</pre>
                        `;
                    } catch (error) {
                        console.error("[Web] Error decoding start_param:", error);
                        document.getElementById('launchParamsLog').innerHTML = "Error decoding start_param.";
                    }
                } else {
                    console.log("[Web] start_param không tồn tại.");
                    document.getElementById('launchParamsLog').innerHTML = "start_param không tồn tại.";
                }
            },
        };
        DemoApp.init();

        // Chia sẻ thông tin qua Telegram
        document.getElementById("btnShare").onclick = function () {
            const shareText = "Check out this amazing game!";
            const shareUrl = "https://t.me/Carot2024Bot";  // URL bạn muốn chia sẻ

            // Mở liên kết chia sẻ trên Telegram
            Telegram.WebApp.openLink(`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`);
        };
    </script>

</body>
</html>
